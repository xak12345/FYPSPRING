<!-- 21041531 - Badi's Code & function--><!DOCTYPE html><html xmlns:th="http://www.thymeleaf.org"><head><title>Booklink - View Items</title><link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css"><link	href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"	rel="stylesheet"	integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"	crossorigin="anonymous"><link	href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css"	rel="stylesheet"><script src="https://code.jquery.com/jquery-3.5.1.js"></script><script defer	src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script><script defer	src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script><script src="/bootstrap/js/bootstrap.js"></script><style>#currency-converter {	margin-bottom: 10px;	}.popup {            display: none;            position: fixed;            top: 0;            left: 0;            width: 100%;            height: 100%;            background-color: rgba(0, 0, 0, 0.7);            z-index: 9999;        }        .popup-content {            max-width: 90%;            max-height: 90%;            display: block;            margin: auto;            position: absolute;            top: 50%;            left: 50%;            transform: translate(-50%, -50%);            background-color: white;            padding: 20px;            border-radius: 10px;            text-align: center;            overflow: auto;        }        .close-btn {            position: absolute;            top: 10px;            right: 10px;            cursor: pointer;            color: black;            font-size: 20px;        }</style></head><body>	<div class="container">		<div th:replace="fragments/header"></div>		<main>			<div class="h1">View Items</div>			<a href="/items/add" class="btn btn-primary">Add Item</a>			<div class="filter-section">				<label for="categorySelect">Category:</label> <select					id="categorySelect" onchange="applyFilters()">					<option value="">All</option>					<option th:each="item : ${listItems}"						th:value="${item.category.name}" th:text="${item.category.name}"></option>				</select> <label for="priceRange">Price Range:</label> <input type="number"					id="minPrice" placeholder="Min Price" /> <input type="number"					id="maxPrice" placeholder="Max Price" />				<button onclick="applyFilters()">Apply</button>			</div>			<input id='myInput' onkeyup='searchTable()' type='text'				placeholder="Type to search">			<table class="table table-hover align-middle mb-0 bg-white"				id='myTable'>				<thead>					<tr>						<th>Owner</th>						<th>Category</th>						<th>Item</th>						<th>Description</th>						<th>Quantity</th>						<th>Price</th>						<th							th:if="${#authorization.expression('hasAnyRole(''ROLE_ADMIN'',''ROLE_SELLER'')')}">Action</th>					</tr>				</thead>				<tbody>					<tr th:each="item : ${listItems}">						<td th:text="${item.seller}"></td>						<td th:text="${item.category.name}"></td>						<td><a th:href="@{/items/{id}(id=${item.id})}"							th:text="${item.name}"></a></td>						<td th:text="${item.description}"></td>						<td th:text="${item.quantity}"></td>						<td>							<p class="price">								$<span id="item-price" class="item-price"									th:text="${item.price}"									th:attr="data-original-price=${item.price}"></span>							</p>						</td>						<td>							<div class="d-flex justify-content-between">								<a									th:if="${#authorization.expression('hasRole(''ROLE_SELLER'') or hasRole(''ROLE_ADMIN'')')}"									th:href="@{/items/edit/{id}(id=${item.id})}"									class="btn btn-primary btn-sm">Edit</a> <a									th:if="${#authorization.expression('hasAnyRole(''ROLE_ADMIN'',''ROLE_SELLER'')')}"									th:href="@{/items/delete/{id}(id=${item.id})}"									class="btn btn-danger btn-sm" onclick="myConfirm(event)">Delete</a>								<a									th:if="${!item.banned && #authorization.expression('hasRole(''ROLE_ADMIN'')')}"									th:href="@{/items/ban/{id}(id=${item.id})}"									class="btn btn-warning btn-sm" onclick="myConfirm(event)">Ban</a>								<a									th:if="${item.banned && #authorization.expression('hasRole(''ROLE_ADMIN'')')}"									th:href="@{/items/unban/{id}(id=${item.id})}"									class="btn btn-success btn-sm" onclick="myConfirm(event)">Unban</a>								<a									th:if="${!item.onSale && #authorization.expression('hasRole(''ROLE_SELLER'')')}"									th:href="@{/items/isOnSale/{id}(id=${item.id})}"									class="btn btn-info btn-sm">List Sale</a> <a									th:if="${#authorization.expression('hasRole(''ROLE_SELLER'')')}"									th:href="@{/items/offSale/{id}(id=${item.id})}"									class="btn btn-secondary btn-sm">Remove Sale</a>							</div>						</td>					</tr>				</tbody>			</table>		</main>		<div th:replace="fragments/footer"></div>				<!-- Popup for displaying the advertisement details -->    <div class="popup" id="popup">        <div class="popup-content">            <span class="close-btn" onclick="closePopup()">&times;</span>            <h2>Advertisement</h2>            <div>                <label>Seller's Name:</label>                <span id="sellerNameSpan"></span>            </div>            <div>                <label>Item Name:</label>                <span id="itemNameSpan"></span>            </div>            <div>                <label>Item Description:</label>                <span id="itemDescriptionSpan"></span>            </div>            <div>                <label>Item Price:</label>                <span id="itemPriceSpan"></span>            </div>            <img src="" alt="Popup Image" id="popupImage" style="max-width: 80%; max-height: 80%; margin-top: 10px;">        </div>    </div>	</div>		<script>
		function searchTable() {
			var input, filter, found, table, tr, td, i, j;
			input = document.getElementById("myInput");
			filter = input.value.toUpperCase();
			table = document.getElementById("myTable");
			tr = table.getElementsByTagName("tr");
			tr = table.querySelectorAll("tbody tr:not(.header)");
			for (i = 0; i < tr.length; i++) {
				td = tr[i].getElementsByTagName("td");
				for (j = 0; j < td.length; j++) {
					if (td[j].innerHTML.toUpperCase().indexOf(filter) > -1) {
						found = true;
					}
				}
				if (found) {
					tr[i].style.display = "";
					found = false;
				} else {
					tr[i].style.display = "none";
				}
			}
		}

		function applyFilters() {
			var categorySelect = document.getElementById("categorySelect");
			var minPrice = parseFloat(document.getElementById("minPrice").value);
			var maxPrice = parseFloat(document.getElementById("maxPrice").value);

			var table = document.getElementById("myTable");
			var rows = table.querySelectorAll("tbody tr");

			rows
					.forEach(function(row) {
						var category = row.querySelector("td:nth-child(1)").innerText;
						var price = parseFloat(row
								.querySelector("td:nth-child(5)").innerText);

						var categoryFilter = categorySelect.value;
						var priceFilter = !isNaN(minPrice) && !isNaN(maxPrice)
								&& price >= minPrice && price <= maxPrice;

						if (categoryFilter === ""
								|| category === categoryFilter) {
							row.style.display = priceFilter ? "" : "none";
						} else {
							row.style.display = "none";
						}
					});
		}

		function myConfirm(event) {
			var result = confirm("Are you sure you want to Ban/Delete this item?");
			if (!result) {
				event.preventDefault(); // Prevent the default behavior (i.e., following the link)
			}
		}				function convertCurrency(element) {	        var fromCurrency = "SGD"; // Base currency is SGD	        var toCurrency = document.getElementById("currency-select").value;	        // Retrieve the price value and the original price attribute from the element	        var itemPrice = parseFloat(element.textContent);	        var originalPrice = parseFloat(element.getAttribute("data-original-price"));	        // Make an API call to get the exchange rate for the selected currencies	        var apiUrl = "https://api.exchangerate-api.com/v4/latest/" + fromCurrency;	        fetch(apiUrl)	            .then(function (response) {	                return response.json();	            })	            .then(function (data) {	                var exchangeRate = data.rates[toCurrency];	                if (exchangeRate) {	                    // Perform the currency conversion for the original price	                    var convertedPrice = originalPrice * exchangeRate;	                    var formattedPrice = convertedPrice.toFixed(2) + " " + toCurrency;	                    element.textContent = formattedPrice;	                } else {	                    console.error("Invalid exchange rate:", exchangeRate);	                }	            })	            .catch(function (error) {	                console.error("Error:", error);	            });	    }	    // Call the convertCurrency function for all elements with the class 'item-price'	    document.addEventListener("DOMContentLoaded", function () {	        var itemPrices = document.querySelectorAll(".item-price");	        itemPrices.forEach(function (element) {	            convertCurrency(element);	        });	        // Handle currency conversion when the currency is changed	        var select = document.getElementById("currency-select");	        select.addEventListener("change", function () {	            itemPrices.forEach(function (element) {	                convertCurrency(element);	            });	        });	    });	    	    	    	    function showPopup() {            // Retrieve the ad details from local storage for all users            var allAds = [];            // Get all keys in local storage            for (var i = 0; i < localStorage.length; i++) {                var key = localStorage.key(i);                if (key.startsWith("ads_")) {                    var userAds = JSON.parse(localStorage.getItem(key)) || [];                    allAds = allAds.concat(userAds);                }            }            // Display the first ad in the popup            if (allAds.length > 0) {                var adDetails = allAds[0];                var popup = document.getElementById("popup");                document.getElementById("sellerNameSpan").innerText = adDetails.sellerName;                document.getElementById("itemNameSpan").innerText = adDetails.itemName;                document.getElementById("itemDescriptionSpan").innerText = adDetails.itemDescription;                document.getElementById("itemPriceSpan").innerText = adDetails.itemPrice;                var img = document.getElementById("popupImage");                img.src = adDetails.itemImage;                popup.style.display = "block";            }        }                function closePopup() {            var popup = document.getElementById("popup");            popup.style.display = "none";        }        // Show the popup when the items page loads        document.addEventListener('DOMContentLoaded', function () {            showPopup();        });        	    
	</script>	</body></html>